--PRODUCTOS


CREATE TABLE D_DE_DATOS.PRODUCTOS_LOCALES (
	cod_productos_locales INT IDENTITY(1,1) PRIMARY KEY,
    cod_producto NVARCHAR(50),
    nombre_producto NVARCHAR(50) NOT NULL,
    desc_producto NVARCHAR(255) NOT NULL,
    precio_unitario_producto DECIMAL(18,2) NOT NULL,
	cod_local INT NOT NULL,
	nombre_local NVARCHAR(255) NOT NULL,
	FOREIGN KEY (cod_local) REFERENCES D_DE_DATOS.locales
);

	--MIGRACION PRODUCTOS
	INSERT INTO D_DE_DATOS.PRODUCTOS_LOCALES (cod_producto, nombre_producto, desc_producto, precio_unitario_producto,cod_local,nombre_local)
	SELECT DISTINCT 
	PRODUCTO_LOCAL_CODIGO,
	PRODUCTO_LOCAL_NOMBRE, 
	PRODUCTO_LOCAL_DESCRIPCION, 
	PRODUCTO_LOCAL_PRECIO,
	L.cod_local,
	M.LOCAL_NOMBRE
	FROM gd_esquema.Maestra
	INNER JOIN D_DE_DATOS.LOCALES L ON M.LOCAL_NOMBRE = L.nombre_local AND M.LOCAL_DIRECCION = L.direccion_local
	WHERE M.PRODUCTO_LOCAL_CODIGO IS NOT NULL AND M.LOCAL_NOMBRE IS NOT NULL




--  ITEMS  183771


	CREATE TABLE D_DE_DATOS.ITEMS (
    cod_item INT IDENTITY(1,1) PRIMARY KEY,
    cod_productos_locales INT  NULL,
    cod_pedido INT  NULL,
    cantidad_item INT NOT NULL,
    precio_unitario_item DECIMAL(18,2) NOT NULL,
    FOREIGN KEY (cod_productos_locales) REFERENCES esquemaPrueba.PRODUCTOS_LOCALES,
    FOREIGN KEY (cod_pedido) REFERENCES D_DE_DATOS.Pedidos
	);

	--MIGRACION ITEMS  183771
	INSERT INTO D_DE_DATOS.ITEMS (cod_productos_locales, cod_pedido, cantidad_item,precio_unitario_item)
	SELECT
	P.cod_productos_locales,
	PE.cod_pedido,
	M.PRODUCTO_CANTIDAD,
	M.PRODUCTO_LOCAL_PRECIO
	FROM gd_esquema.Maestra
	INNER JOIN D_DE_DATOS.PEDIDOS PE ON M.PEDIDO_NRO = PE.cod_pedido
	INNER JOIN D_DE_DATOS.PRODUCTOS_LOCALES P ON P.nombre_local = M.LOCAL_NOMBRE AND P.cod_producto = M.PRODUCTO_LOCAL_CODIGO
	WHERE M.PEDIDO_NRO IS NOT NULL AND M.PRODUCTO_LOCAL_CODIGO IS NOT NULL AND M.RECLAMO_NRO IS NULL;
